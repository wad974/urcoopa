<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <title>Factures fournisseurs</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static' , path='/css/style.css') }}">
</head>

<body>
    <!-- Loader -->
    <div id="loader" class="d-flex justify-content-center align-items-center hideloader">
        <div class="text-center">
            <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
                <span class="visually-hidden">Chargement...</span>
            </div>
            <p class="mt-3">Traitement en cours...</p>
        </div>
    </div>
    <!-- Top Navigation Bar -->
    <nav class="topbar d-flex justify-content-between align-items-center">
        <div class="d-flex align-items-center">
            <i class="bi bi-x-diamond-fill me-2 text-primary"></i>
            <a href="https://sdpmajdb-odoo17-dev-staging-sicalait-23500291.dev.odoo.com/web#action=288&model=account.journal&view_type=kanban&cids=5-48-49-50-51-52-53-54-55-68-19-43-44-45-46-47&menu_id=311"
                class="nav-link d-inline link-underline-opacity-100-hover">
                <span class="fw-bold me-4">Factures adh√©rents urcoopa</span>
            </a>
            <a id="touslesfactures" class="nav-link d-inline" title="Affiche tous les factures" href="/">üßæ Les
                factures</a>

            <a id="touslesavoirs" class="nav-link d-inline link-underline-hover" title="Affiche tous les Avoirs"
                href="#">üìë Les avoirs</a>

            <a id="documentComptable" class="nav-link d-inline link-underline-hover"
                title="Affiche le document comptable" href="#">üìä VRAC</a>

            <a id="documentInconnu" class="nav-link d-inline link-underline-hover" title="Affiche les inconnus"
                href="#">‚ùå Donn√©es inconnus</a>

            <a id="dashboard" class="nav-link d-inline link-underline-hover" title="Affiche le dashboard"
                href="/tableaudebord" style="color: white;">dashboard</a>
        </div>
        <div>
            <a type="button" class="btn btn-primary btn-sm"
                href="https://staging-erp.groupe-sicalait.fr/web#action=288&model=account.journal&view_type=kanban">Retour</a>
        </div>
    </nav>

    <!--SWITCH AJAX-->
    <!--dashboard-->
    <div id="data_dashboard" style="display: none;"></div>
    <!-- Modal Document Comptable -->
    <div id="documentComptableModal">
        <div class="modal-content-custom bg-white rounded shadow-lg">
            <div class="modal-header border-bottom p-3 d-flex justify-content-between align-items-center">
                <h5 class="modal-title mb-0">üìä Document Comptable - TVA COLLECTEE 2.1%</h5>
                <button type="button" class="btn-close" id="closeDocumentModal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-0">
                <div class="document-comptable-container">
                    <!-- En-t√™te -->
                    <div class="header-section">
                        <h6 class="fw-bold mb-3 text-primary">En-t√™te de la pi√®ce</h6>

                        <div class="row mb-2">
                            <div class="col-md-8">
                                <div class="row">
                                    <div class="col-auto">
                                        <strong>Date d'op√©ration:</strong> <span
                                            class="text-primary dateOperation"></span>
                                    </div>
                                    <!--
                                    <div class="col-auto">
                                        <strong>Num√©ro de Document:</strong> <span class="text-primary">00000000</span>
                                    </div>
                                    
                                    <div class="col-auto">
                                        <strong>du:</strong> <span class="text-primary dateFin"></span>
                                    </div>
                                    -->
                                </div>
                            </div>
                            <!--
                            <div class="col-md-4">
                                <div class="d-flex flex-column gap-1">
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="libelle" id="libelle_ecriture" checked>
                                        <label class="form-check-label small" for="libelle_ecriture">Libell√© √©criture</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="libelle" id="libelle_compte">
                                        <label class="form-check-label small" for="libelle_compte">Libell√© compte</label>
                                    </div>
                                </div>
                            </div>-->
                        </div>

                        <div class="row mb-2">
                            <!--
                            <div class="col-auto">
                                <strong>Date d'√©ch√©ance:</strong> <span class="text-primary dateEcheance"></span>
                            </div>
                            -->
                            <div class="col-auto">
                                <strong>Devise d'affichage:</strong>
                                <select class="form-select form-select-sm d-inline-block" style="width: auto;">
                                    <option selected>Euro</option>
                                </select>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12">
                                <strong>Libell√©:</strong> <span class="text-primary">TVA COLLECTEE 2.1%</span>
                            </div>
                        </div>
                    </div>

                    <!-- D√©tail -->
                    <div class="details-section">
                        D√©tail de la pi√®ce
                    </div>

                    <!-- Tableau -->
                    <div class="table-responsive">
                        <table class="document-table table table-sm mb-0">
                            <thead>
                                <tr>
                                    <th>Aux.</th>
                                    <th>Compte</th>
                                    <th>Libell√©</th>
                                    <th>Montant D√©bit (avoir)</th>
                                    <th>Montant Cr√©dit (facture)</th>
                                    <th>Devise</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="tva-row">
                                    <td class="center-cell fw-bold"></td>
                                    <td></td>
                                    <td></td>
                                    <td class="number-cell"></td>
                                    <td class="number-cell fw-bold text-success"></td>
                                    <td class="center-cell"></td>
                                    <td class="center-cell"></td>
                                </tr>
                                <tr class="tva-row">
                                    <td class="center-cell fw-bold"></td>
                                    <td></td>
                                    <td></td>
                                    <td class="number-cell fw-bold text-danger"></td>
                                    <td class="number-cell"></td>
                                    <td class="center-cell"></td>
                                    <td class="center-cell"></td>
                                </tr>
                                <tr>
                                    <td class="center-cell fw-bold"></td>
                                    <td></td>
                                    <td></td>
                                    <td class="number-cell fw-bold text-danger"></td>
                                    <td class="number-cell"></td>
                                    <td class="center-cell"></td>
                                    <td class="center-cell"></td>
                                </tr>
                                <tr>
                                    <td class="center-cell fw-bold"></td>
                                    <td></td>
                                    <td></td>
                                    <td class="number-cell"></td>
                                    <td class="number-cell fw-bold text-success"></td>
                                    <td class="center-cell"></td>
                                    <td class="center-cell"></td>
                                </tr>
                                <tr>
                                    <td class="center-cell fw-bold"></td>
                                    <td></td>
                                    <td></td>
                                    <td class="number-cell fw-bold text-danger"></td>
                                    <td class="number-cell"></td>
                                    <td class="center-cell"></td>
                                    <td class="center-cell"></td>
                                </tr>
                                <tr>
                                    <td class="center-cell fw-bold"></td>
                                    <td></td>
                                    <td></td>
                                    <td class="number-cell"></td>
                                    <td class="number-cell fw-bold text-success"></td>
                                    <td class="center-cell"></td>
                                    <td class="center-cell"></td>
                                </tr>
                                <tr>
                                    <td class="center-cell fw-bold"></td>
                                    <td></td>
                                    <td></td>
                                    <td class="number-cell"></td>
                                    <td class="number-cell fw-bold text-success"></td>
                                    <td class="center-cell"></td>
                                    <td class="center-cell"></td>
                                </tr>
                                <tr>
                                    <td class="center-cell fw-bold"></td>
                                    <td></td>
                                    <td></td>
                                    <td class="number-cell fw-bold text-danger"></td>
                                    <td class="number-cell"></td>
                                    <td class="center-cell"></td>
                                    <td class="center-cell"></td>
                                </tr>
                                <tr>
                                    <td class="center-cell fw-bold"></td>
                                    <td></td>
                                    <td></td>
                                    <td class="number-cell"></td>
                                    <td class="number-cell fw-bold text-success"></td>
                                    <td class="center-cell"></td>
                                    <td class="center-cell"></td>
                                </tr>
                                <tr>
                                    <td class="center-cell fw-bold"></td>
                                    <td></td>
                                    <td></td>
                                    <td class="number-cell fw-bold text-danger"></td>
                                    <td class="number-cell"></td>
                                    <td class="center-cell"></td>
                                    <td class="center-cell"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer border-top p-3">
                <!--
                    <button type="button" class="btn btn-outline-primary btn-sm">
                        <i class="bi bi-printer"></i> Imprimer
                    </button>
                    <button type="button" class="btn btn-success btn-sm">
                        <i class="bi bi-check-circle"></i> Valider l'√©criture
                    </button>
                -->
                <button type="button" class="btn btn-secondary btn-sm" id="closeDocumentModalFooter">
                    <i class="bi bi-x-circle"></i> Fermer
                </button>
            </div>
        </div>
    </div>

    <!--DATA INCONNU-->
    <div id="data_inconnu" class="container-fluid mt-4"></div>

    <div id="bloc_principal" class="container-fluid mt-4">

        <!--PAGE VALIDATION-->
        <div id="validationPage"></div>
        <div class="d-flex justify-content-between mb-3">
            <div class="d-flex align-items-center flex-wrap gap-2 my-3">
                <button type="button" id="aTraiter" class="btn btn-outline-warning shadow-sm active">
                    üïí √Ä traiter
                </button>

                <button type="button" id="aValider" class="btn btn-outline-success shadow-sm">
                    ‚úÖ D√©j√† valid√©es
                </button>

                <button type="button" id="clientAdherent" class="btn btn-outline-primary shadow-sm">
                    üë§ Client Adh√©rent
                </button>

                <button type="button" id="clientNonAdherent" class="btn btn-outline-secondary shadow-sm">
                    üë• Non Adh√©rent
                </button>

                <button type="button" id="clientInconnu" class="btn btn-outline-danger shadow-sm">
                    ‚ùì Client Inconnu
                </button>
            </div>
            <div class="d-flex align-items-center gap-3">
                <h5 id="TTC" class=" container-fluid ms-3 mt-1"></h5>
                <h5 id="HT" class=" container-fluid ms-3 mt-1"></h5>
                <div class="form-group mb-0">
                    <select name="dateInput" id="dateInput" class="form-select form-select-sm"
                        style="min-width: 180px;">
                        <option value="">üìÖ Filtrer par mois</option>
                        <!-- options dynamiques ici -->
                    </select>
                </div>
                <input type="text" id="myInput" onkeyup="myFunction()"
                    class="container-fluid ms-3 form-control search-bar" placeholder="Rechercher...">
            </div>
        </div>
        <!-- Titre principal avec ic√¥ne -->
        <h3 class="fw-bold text-dark">
            üìÑ Factures Urcoopa ‚Äì <span id="tableCaption" class="text-primary">Toutes les factures</span>
        </h3>
        <h6 class="d-flex justify-content-end">
            Nombre de facture : <span id="nombreFacture"></span>
        </h6>
        <table id="myTable" class="table table-bordered table-hover align-middle mt-4">
            <thead class="table-dark">
                <!--<tr>
                    <th>R√©f√©rence</th>
                    <th>Code Client</th>
                    <th>Code_Produit</th>
                    <th>Libelle_Produit</th>
                    <th>Date de facturation</th>
                    <th>Date d'√©ch√©ance</th>
                    <th>Nom du client</th>
                    <th>Hors taxes</th>
                    <th>Total</th>
                </tr>-->
                <tr class="header">
                    <th>R√©f√©rence</th>
                    <th>Code Client</th>
                    <th>Date de facturation</th>
                    <th>Date d'√©ch√©ance</th>
                    <th>Nom du client</th>
                    <th>Total</th>
                </tr>
            </thead>
            <tbody id="TableauValeur">

            </tbody>
            <tfoot class="table-light">
                <!--<tr>
                    <td colspan="3" rowspan="2"></td>
                    <td rowspan="2" class="text-center">
                        
                        <button type="button" id="ValiderTotal" class="btn btn-success btn-sm shadow-sm">
                            ‚úÖ Valider tout
                        </button>
                    </td>
                    <td class="fw-bold text-end text-muted">Total HT :</td>
                    <td class="fw-bold text-primary" id="htFooter">-- ‚Ç¨</td>
                </tr>
                <tr>
                    <td class="fw-bold text-end text-muted">Total TTC :</td>
                    <td class="fw-bold text-primary" id="ttcFooter">-- ‚Ç¨</td>
                </tr>-->
            </tfoot>
        </table>
    </div>

    <script src="{{ url_for( 'static', path='/js/script.js')}}"></script>
    <script src="{{ url_for( 'static', path='/js/donneesComptables.js')}}"></script>
    <script src="{{ url_for( 'static', path='/js/index.js') }}"></script>

    <script>

        //on recupere tous les donn√©es depuis python en convertissant en json pour JAVASCRIPT
        let factures = {{ FACTURES | tojson | safe }};
        //console.log('DANS FACTURES : ', factures);
        let donneesComptables = {{ donnees_comptables | tojson | safe }};
        //console.log('Donn√©es Comptable: ', donneesComptables)

        // montant_ttc
        let montant_total_ttc = {{ total_ttc }};
        montant_total_ttc = Number.parseFloat(montant_total_ttc).toFixed(2);
        //montant_ht
        let montant_total_ht = {{ total_ht }};
        montant_total_ht = Number.parseFloat(montant_total_ht).toFixed(2);
        
        recuperationFacture(factures)
    </script>

</body>

</html>