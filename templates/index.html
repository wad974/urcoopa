<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <title>Factures fournisseurs</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static' , path='/css/style.css') }}">
</head>

<style>
    #validationPage {
        display: none;
        position: fixed;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        background-color: rgba(0, 0, 0, 0.8);
        overflow: auto;
    }

    #myInput {
        background-image: url('static/css/searchicon.png');
        /* Add a search icon to input */
        background-position: 10px 12px;
        /* Position the search icon */
        background-repeat: no-repeat;
        /* Do not repeat the icon image */
        background-size: 25px;
        width: 350px;
        /* Full-width */
        font-size: 16px;
        /* Increase font-size */
        padding: 12px 20px 12px 40px;
        /* Add some padding */
        border: 1px solid #ddd;
        /* Add a grey border */
        margin-bottom: 12px;
        /* Add some space below the input */
    }

    #myTable {
        border-collapse: collapse;
        /* Collapse borders */
        width: 100%;
        /* Full-width */
        border: 1px solid #ddd;
        /* Add a grey border */
        font-size: 16px;
        /* Increase font-size */
    }

    #myTable th,
    #myTable td {
        text-align: left;
        /* Left-align text */
        padding: 12px;
        /* Add padding */
    }

    #myTable tr {
        /* Add a bottom border to all table rows */
        border-bottom: 1px solid #ddd;
    }

    #myTable tr.header,
    #myTable tr:hover {
        /* Add a grey background color to the table header and on hover */
        background-color: #f1f1f1;
    }

    .btn {
        padding: 0.5rem 0.75rem !important;
        font-size: 0.875rem !important;
    }

    #loader {
        backdrop-filter: blur(2px);
    }

    .chargement {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(255, 255, 255, 0.8);
        z-index: 9999;
    }

    .hideloader {
        display: none !important;
    }

    #validationPage {
        display: none;
        position: fixed;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        background-color: rgba(0, 0, 0, 0.8);
        overflow: auto;
        z-index: 1050;
    }

    #documentComptableModal {
        display: none;
        position: fixed;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        background-color: rgba(0, 0, 0, 0.8);
        overflow: auto;
        z-index: 1050;
    }

    .modal-content-custom {
        margin: 2% auto;
        max-width: 90%;
        width: auto;
        min-width: 800px;
    }

    #myInput {
        background-image: url('static/css/searchicon.png');
        background-position: 10px 12px;
        background-repeat: no-repeat;
        background-size: 25px;
        width: 350px;
        font-size: 16px;
        padding: 12px 20px 12px 40px;
        border: 1px solid #ddd;
        margin-bottom: 12px;
    }

    #myTable {
        border-collapse: collapse;
        width: 100%;
        border: 1px solid #ddd;
        font-size: 16px;
    }

    #myTable th,
    #myTable td {
        text-align: left;
        padding: 12px;
    }

    #myTable tr {
        border-bottom: 1px solid #ddd;
    }

    #myTable tr.header,
    #myTable tr:hover {
        background-color: #f1f1f1;
    }

    .btn {
        padding: 0.5rem 0.75rem !important;
        font-size: 0.875rem !important;
    }

    #loader {
        backdrop-filter: blur(2px);
    }

    .chargement {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(255, 255, 255, 0.8);
        z-index: 9999;
    }

    .hideloader {
        display: none !important;
    }

    /* Styles pour le document comptable */
    .document-comptable-container {
        background-color: white;
        border: 2px solid #dee2e6;
        border-radius: 0.375rem;
    }

    .header-section {
        background-color: #f8f9fa;
        padding: 1rem;
        border-bottom: 1px solid #dee2e6;
        border-radius: 0.375rem 0.375rem 0 0;
    }

    .details-section {
        background-color: #e9ecef;
        padding: 0.75rem 1rem;
        border-bottom: 1px solid #dee2e6;
        font-weight: 600;
        color: #495057;
    }

    .document-table {
        font-size: 0.875rem;
    }

    .document-table th {
        background-color: #495057;
        color: white;
        border: 1px solid #dee2e6;
        padding: 0.5rem;
        text-align: center;
        font-weight: 600;
    }

    .document-table td {
        border: 1px solid #dee2e6;
        padding: 0.375rem 0.75rem;
        text-align: left;
    }

    .number-cell {
        text-align: right;
        font-family: 'Courier New', monospace;
    }

    .center-cell {
        text-align: center;
    }

    .tva-row {
        background-color: #fff3cd;
    }

    .document-table tbody tr:hover {
        background-color: #f8f9fa;
    }
</style>

<body>
    <!-- Loader -->
    <div id="loader" class="d-flex justify-content-center align-items-center hideloader">
        <div class="text-center">
            <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
                <span class="visually-hidden">Chargement...</span>
            </div>
            <p class="mt-3">Traitement en cours...</p>
        </div>
    </div>
    <!-- Top Navigation Bar -->
    <nav class="topbar d-flex justify-content-between align-items-center">
        <div class="d-flex align-items-center">
            <i class="bi bi-x-diamond-fill me-2 text-primary"></i>
            <a href="https://staging-erp.groupe-sicalait.fr/web#action=288&model=account.journal&view_type=kanban"
                class="nav-link d-inline link-underline-opacity-100-hover">
                <span class="fw-bold me-4">Factures adh√©rents urcoopa</span>
            </a>
            <a id="touslesfactures" class="nav-link d-inline" title="Affiche tous les factures" href="/">Tous les
                factures</a>

            <a id="touslesavoirs" class="nav-link d-inline link-underline-hover" title="Affiche tous les Avoirs"
                href="#">Tous les Avoirs</a>

            <a id="documentComptable" class="nav-link d-inline link-underline-hover" title="Affiche le document comptable"
                href="#">üìä VRAC</a>
        </div>
        <div>
            <a type="button" class="btn btn-primary btn-sm"
                href="https://staging-erp.groupe-sicalait.fr/web#action=288&model=account.journal&view_type=kanban">Retour</a>
        </div>
    </nav>

    <!--SWITCH AJAX-->
    <!-- Modal Document Comptable -->
    <div id="documentComptableModal">
        <div class="modal-content-custom bg-white rounded shadow-lg">
            <div class="modal-header border-bottom p-3 d-flex justify-content-between align-items-center">
                <h5 class="modal-title mb-0">üìä Document Comptable - TVA COLLECTEE 2.1%</h5>
                <button type="button" class="btn-close" id="closeDocumentModal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-0">
                <div class="document-comptable-container">
                    <!-- En-t√™te -->
                    <div class="header-section">
                        <h6 class="fw-bold mb-3 text-primary">En-t√™te de la pi√®ce</h6>
                        
                        <div class="row mb-2">
                            <div class="col-md-8">
                                <div class="row">
                                    <div class="col-auto">
                                        <strong>Date d'op√©ration:</strong> <span class="text-primary dateOperation"></span>
                                    </div>
                                    <div class="col-auto">
                                        <strong>Num√©ro de Document:</strong> <span class="text-primary">00000000</span>
                                    </div>
                                    <div class="col-auto">
                                        <strong>du:</strong> <span class="text-primary"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="d-flex flex-column gap-1">
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="libelle" id="libelle_ecriture" checked>
                                        <label class="form-check-label small" for="libelle_ecriture">Libell√© √©criture</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="libelle" id="libelle_compte">
                                        <label class="form-check-label small" for="libelle_compte">Libell√© compte</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mb-2">
                            <div class="col-auto">
                                <strong>Date d'√©ch√©ance:</strong> <span class="text-primary dateEcheance"></span>
                            </div>
                            <div class="col-auto">
                                <strong>Devise d'affichage:</strong> 
                                <select class="form-select form-select-sm d-inline-block" style="width: auto;">
                                    <option selected>Euro</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-12">
                                <strong>Libell√©:</strong> <span class="text-primary">TVA COLLECTEE 2.1%</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- D√©tail -->
                    <div class="details-section">
                        D√©tail de la pi√®ce
                    </div>
                    
                    <!-- Tableau -->
                    <div class="table-responsive">
                        <table class="document-table table table-sm mb-0">
                            <thead>
                                <tr>
                                    <th>Aux.</th>
                                    <th>Compte</th>
                                    <th>Libell√©</th>
                                    <th>Montant avoir</th>
                                    <th>Montant facture</th>
                                    <th>Devise</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="tva-row">
                                    <td class="center-cell fw-bold"></td>
                                    <td></td>
                                    <td></td>
                                    <td class="number-cell"></td>
                                    <td class="number-cell fw-bold text-success"></td>
                                    <td class="center-cell"></td>
                                    <td class="center-cell"></td>
                                </tr>
                                <tr class="tva-row">
                                    <td class="center-cell fw-bold"></td>
                                    <td></td>
                                    <td></td>
                                    <td class="number-cell fw-bold text-danger"></td>
                                    <td class="number-cell"></td>
                                    <td class="center-cell"></td>
                                    <td class="center-cell"></td>
                                </tr>
                                <tr>
                                    <td class="center-cell fw-bold"></td>
                                    <td></td>
                                    <td></td>
                                    <td class="number-cell fw-bold text-danger"></td>
                                    <td class="number-cell"></td>
                                    <td class="center-cell"></td>
                                    <td class="center-cell"></td>
                                </tr>
                                <tr>
                                    <td class="center-cell fw-bold"></td>
                                    <td></td>
                                    <td></td>
                                    <td class="number-cell"></td>
                                    <td class="number-cell fw-bold text-success"></td>
                                    <td class="center-cell"></td>
                                    <td class="center-cell"></td>
                                </tr>
                                <tr>
                                    <td class="center-cell fw-bold"></td>
                                    <td></td>
                                    <td></td>
                                    <td class="number-cell fw-bold text-danger"></td>
                                    <td class="number-cell"></td>
                                    <td class="center-cell"></td>
                                    <td class="center-cell"></td>
                                </tr>
                                <tr>
                                    <td class="center-cell fw-bold"></td>
                                    <td></td>
                                    <td></td>
                                    <td class="number-cell"></td>
                                    <td class="number-cell fw-bold text-success"></td>
                                    <td class="center-cell"></td>
                                    <td class="center-cell"></td>
                                </tr>
                                <tr>
                                    <td class="center-cell fw-bold"></td>
                                    <td></td>
                                    <td></td>
                                    <td class="number-cell"></td>
                                    <td class="number-cell fw-bold text-success"></td>
                                    <td class="center-cell"></td>
                                    <td class="center-cell"></td>
                                </tr>
                                <tr>
                                    <td class="center-cell fw-bold"></td>
                                    <td></td>
                                    <td></td>
                                    <td class="number-cell fw-bold text-danger"></td>
                                    <td class="number-cell"></td>
                                    <td class="center-cell"></td>
                                    <td class="center-cell"></td>
                                </tr>
                                <tr>
                                    <td class="center-cell fw-bold"></td>
                                    <td></td>
                                    <td></td>
                                    <td class="number-cell"></td>
                                    <td class="number-cell fw-bold text-success"></td>
                                    <td class="center-cell"></td>
                                    <td class="center-cell"></td>
                                </tr>
                                <tr>
                                    <td class="center-cell fw-bold"></td>
                                    <td></td>
                                    <td></td>
                                    <td class="number-cell fw-bold text-danger"></td>
                                    <td class="number-cell"></td>
                                    <td class="center-cell"></td>
                                    <td class="center-cell"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer border-top p-3">
                <button type="button" class="btn btn-outline-primary btn-sm">
                    <i class="bi bi-printer"></i> Imprimer
                </button>
                <button type="button" class="btn btn-success btn-sm">
                    <i class="bi bi-check-circle"></i> Valider l'√©criture
                </button>
                <button type="button" class="btn btn-secondary btn-sm" id="closeDocumentModalFooter">
                    <i class="bi bi-x-circle"></i> Fermer
                </button>
            </div>
        </div>
    </div>

    <div class="container-fluid mt-4">
        <!--PAGE VALIDATION-->
        <div id="validationPage"></div>
        <div class="d-flex justify-content-between mb-3">
            <div class="d-flex align-items-center flex-wrap gap-2 my-3">
                <button type="button" id="aTraiter" class="btn btn-outline-warning shadow-sm active">
                    üïí √Ä traiter
                </button>

                <button type="button" id="aValider" class="btn btn-outline-success shadow-sm">
                    ‚úÖ D√©j√† valid√©es
                </button>

                <button type="button" id="clientAdherent" class="btn btn-outline-primary shadow-sm">
                    üë§ Client Adh√©rent
                </button>

                <button type="button" id="clientNonAdherent" class="btn btn-outline-secondary shadow-sm">
                    üë• Non Adh√©rent
                </button>

                <button type="button" id="clientInconnu" class="btn btn-outline-danger shadow-sm">
                    ‚ùì Client Inconnu
                </button>
            </div>
            <div class="d-flex align-items-center gap-3">
                <h5 id="TTC" class=" container-fluid ms-3 mt-1"></h5>
                <h5 id="HT" class=" container-fluid ms-3 mt-1"></h5>
                <div class="form-group mb-0">
                    <select name="dateInput" id="dateInput" class="form-select form-select-sm"
                        style="min-width: 180px;">
                        <option value="">üìÖ Filtrer par mois</option>
                        <!-- options dynamiques ici -->
                    </select>
                </div>
                <input type="text" id="myInput" onkeyup="myFunction()"
                    class="container-fluid ms-3 form-control search-bar" placeholder="Rechercher...">
            </div>
        </div>
        <!-- Titre principal avec ic√¥ne -->
        <h2 class="fw-bold text-dark mb-3">
            üìÑ Factures Urcoopa ‚Äì <span id="tableCaption" class="text-primary">Toutes les factures</span>
        </h2>
        <h3>
            Nombre de facture : <span id="nombreFacture"></span>
        </h3>
        <table id="myTable" class="table table-bordered table-hover align-middle mt-4">
            <thead class="table-dark">
                <!--<tr>
                    <th>R√©f√©rence</th>
                    <th>Code Client</th>
                    <th>Code_Produit</th>
                    <th>Libelle_Produit</th>
                    <th>Date de facturation</th>
                    <th>Date d'√©ch√©ance</th>
                    <th>Nom du client</th>
                    <th>Hors taxes</th>
                    <th>Total</th>
                </tr>-->
                <tr class="header">
                    <th>R√©f√©rence</th>
                    <th>Code Client</th>
                    <th>Date de facturation</th>
                    <th>Date d'√©ch√©ance</th>
                    <th>Nom du client</th>
                    <th>Total</th>
                </tr>
            </thead>
            <tbody id="TableauValeur">

            </tbody>
            <tfoot class="table-light">
                <tr>
                    <td colspan="3" rowspan="2"></td>
                    <td rowspan="2" class="text-center">
                        <button type="button" id="ValiderTotal" class="btn btn-success btn-sm shadow-sm">
                            ‚úÖ Valider tout
                        </button>
                    </td>
                    <td class="fw-bold text-end text-muted">Total HT :</td>
                    <td class="fw-bold text-primary" id="htFooter">-- ‚Ç¨</td>
                </tr>
                <tr>
                    <td class="fw-bold text-end text-muted">Total TTC :</td>
                    <td class="fw-bold text-primary" id="ttcFooter">-- ‚Ç¨</td>
                </tr>
            </tfoot>
        </table>
    </div>
    <script src="{{ url_for( 'static', path='/js/script.js' ) }}"></script>
    <script src="{{ url_for( 'static', path='/js/donneesComptables.js' ) }}"></script>
    <script>
        //on recupere tous les donn√©es depuis python en convertissant en json pour JAVASCRIPT
        let factures = {{ FACTURES | tojson | safe }};
        console.log('DANS FACTURES : ', factures);

        let donneesComptables = {{ donnees_comptables | tojson | safe }};
        console.log('Donn√©es Comptable: ', donneesComptables)

        // je recupere mes boutons
        let bouton_facture = document.querySelector('#touslesfactures');
        let bouton_avoirs = document.querySelector('#touslesavoirs');
        let bouton_Factures_Valider = document.querySelector('#aValider');
        let bouton_Factures_A_Traiter = document.querySelector('#aTraiter');
        let bouton_Factures_Client_Adherent = document.querySelector('#clientAdherent');
        let bouton_Factures_Client_Non_Adherent = document.querySelector('#clientNonAdherent');
        let bouton_Factures_Client_Inconnu = document.querySelector('#clientInconnu');

        let etat_facture_valider = 0

        // montant_ttc
        let montant_total_ttc = {{ total_ttc }};
        montant_total_ttc = Number.parseFloat(montant_total_ttc).toFixed(2);
        //montant_ht
        let montant_total_ht = {{ total_ht }};
        montant_total_ht = Number.parseFloat(montant_total_ht).toFixed(2);
        /****/
        //document.querySelector('#TTC').innerHTML = ' TTC : ' + montant_total_ttc;
        //document.querySelector('#HT').innerHTML = ' HT : ' + montant_total_ht;

        //TABLEAU 
        const tbody = document.getElementById('TableauValeur');
        const tcaption = document.getElementById('tableCaption');
        if (factures) {

            const facturesParNumero = {}; // cl√© = Numero_Facture

            factures.forEach(f => {
                const numero = f.Numero_Facture;
                if (!facturesParNumero[numero]) {
                    facturesParNumero[numero] = [];
                }
                facturesParNumero[numero].push(f);
            });

            // boucle sur factures
            tableauAdherent(facturesParNumero, etat_facture_valider)

            /*let bouton_row = document.querySelectorAll('.ligneRow')
            //console.log(bouton_row)
            if (bouton_row) {
                bouton_row.forEach(row => {
                    row.addEventListener('click', (event) => {
                        const index = row.dataset.index;
                        const facture = factures[index];
                        console.log('FACTURE CLIQU√âE:', facture);

                        loadPageValidation(facture);
                    });
                });
            }*/

            // bouton facture a traiter
            if (bouton_Factures_A_Traiter) {
                bouton_Factures_A_Traiter.addEventListener('click', function (event) {
                    event.preventDefault();
                    event.stopPropagation();
                    if (tcaption) {
                        tcaption.innerHTML = 'A traiter'
                    }
                    etat_facture_valider = 0;
                    tbody.innerHTML = '';
                    tableauAdherent(facturesParNumero, etat_facture_valider);
                });
            }

            // je vais ecouter lors des clics 
            if (bouton_avoirs) {
                bouton_avoirs.addEventListener('click', (event) => {
                    event.preventDefault();
                    event.stopPropagation();
                    if (tcaption) {
                        tcaption.innerHTML = 'Tous les avoirs'
                    }
                    etat_facture_valider = 0
                    loadPageFactureAvoir(facturesParNumero, etat_facture_valider); // Passer toutes les factures
                });
            }

            // traitement des information recuperer
            if (bouton_Factures_Valider) {
                bouton_Factures_Valider.addEventListener('click', function (event) {
                    event.preventDefault();
                    event.stopPropagation();
                    if (tcaption) {
                        tcaption.innerHTML = 'D√©j√† valid√©es'
                    }
                    //console.log('ETAT 1')
                    etat_facture_valider = 1;
                    loadPageFactureValider(facturesParNumero, etat_facture_valider);
                });
            }

            // Traitement client adherent
            if (bouton_Factures_Client_Adherent) {
                bouton_Factures_Client_Adherent.addEventListener('click', (event) => {
                    event.preventDefault();
                    event.preventDefault();
                    if (tcaption) {
                        tcaption.innerHTML = 'Les clients adh√©rents'
                    }
                    etat_facture_valider = 0;
                    loadPageFactureClientAdherent(facturesParNumero, etat_facture_valider)
                });
            }

            // Traitement bouton_Factures_Client_Non_Adherent 
            if (bouton_Factures_Client_Non_Adherent) {
                bouton_Factures_Client_Non_Adherent.addEventListener('click', (event) => {
                    event.preventDefault();
                    event.preventDefault();
                    if (tcaption) {
                        tcaption.innerHTML = 'Les clients non adh√©rents'
                    }
                    etat_facture_valider = 0;
                    loadPageFactureClientNonAdherent(facturesParNumero, etat_facture_valider)
                });
            }

            // Traitement bouton_Factures_Client_Inconnu
            if (bouton_Factures_Client_Inconnu) {
                bouton_Factures_Client_Inconnu.addEventListener('click', (event) => {
                    event.preventDefault();
                    event.preventDefault();
                    if (tcaption) {
                        tcaption.innerHTML = 'Les clients inconnu'
                    }
                    etat_facture_valider = 0;
                    loadPageFactureClientInconnu(facturesParNumero, etat_facture_valider)
                });
            }

            // traitement facture par date
            // filtre par dates
            const dateFiltre = document.getElementById('dateInput');
            const moisSet = new Set();

            // extraire les mois
            factures.forEach(f => {
                //console.log('TESTE FACTURE -> ',f)
                const dateFacturation = new Date(f.Date_Facture);
                //console.log('TESTE DATE -> ',dateFacturation) 
                const moisAnnee = `${dateFacturation.getFullYear()}-${(dateFacturation.getMonth() + 1).toString().padStart(2, '0')}`;
                //console.log('TESTE mois Ann√©es -> ', moisAnnee)
                moisSet.add(moisAnnee);
            });

            //console.log('moisSet -> ', moisSet)

            // trier les mois r√©cents en premier
            const moisList = Array.from(moisSet).sort().reverse();

            // ajouter dans le select
            moisList.forEach(mois => {
                const option = document.createElement('option');
                option.value = mois;
                option.textContent = `üìÖ ${mois}`;
                dateFiltre.appendChild(option);
            });


            dateFiltre.addEventListener('change', (event) => {
                const valeurMois = event.target.value;

                tbody.innerHTML = '';

                const facturesFiltr√©es = {};
                for (let numero in facturesParNumero) {
                    const lignes = facturesParNumero[numero];
                    const dateFacturation = new Date(lignes[0].Date_Facture);
                    const moisAnnee = `${dateFacturation.getFullYear()}-${(dateFacturation.getMonth() + 1).toString().padStart(2, '0')}`;


                    //console.log('lignes -> ', lignes )
                    //console.log('dateFacturation -> ', dateFacturation )
                    //console.log('mmoisAnn√©e -> ', moisAnnee )
                    //console.log('valuer mois -> ' ,valeurMois)

                    if (valeurMois === "" || moisAnnee === valeurMois) {
                        facturesFiltr√©es[numero] = lignes;
                    }
                }
                //console.log('factures filtr√©s -> ', facturesFiltr√©es) 
                tableauAdherent(facturesFiltr√©es, etat_facture_valider);
            });

        }

        if (bouton_facture) {
            bouton_facture.addEventListener('click', (event) => {
                //alert('BOUTON FACTURES CLICKER')
            });
        }

        // function recherche tableau
        function myFunction() {
            const input = document.getElementById("myInput");
            const filter = input.value.toUpperCase();
            const table = document.getElementById("myTable");
            const tr = table.getElementsByTagName("tr");

            for (let i = 1; i < tr.length; i++) {
                // i = 1 pour ignorer l'en-t√™te
                const tds = tr[i].getElementsByTagName("td");
                let rowMatches = false;

                for (let j = 0; j < tds.length; j++) {
                    const td = tds[j];
                    if (td) {
                        const txtValue = td.textContent || td.innerText;
                        if (txtValue.toUpperCase().indexOf(filter) > -1) {
                            rowMatches = true;
                            break;
                        }
                    }
                }

                tr[i].style.display = rowMatches ? "" : "none";
            }
        }

        // Ajouter l'√©v√©nement au bouton "Valider tout"
        document.addEventListener('DOMContentLoaded', function () {
            const boutonValiderTout = document.getElementById('ValiderTotal');
            if (boutonValiderTout) {
                boutonValiderTout.addEventListener('click', validerToutesFactures);
            }

            // Calculer les totaux au chargement initial
            calculerTotaux();

            // Mettre √† jour les totaux apr√®s chaque filtrage
            const originalMyFunction = window.myFunction;
            window.myFunction = function () {
                originalMyFunction();
                mettreAJourTotauxApresFiltre();
            };

            // Mettre √† jour les totaux apr√®s les filtres par boutons
            document.querySelectorAll('[id^="aTraiter"], [id^="aValider"], [id^="client"]').forEach(btn => {
                btn.addEventListener('click', mettreAJourTotauxApresFiltre);
            });

            // Mettre √† jour les totaux apr√®s le filtre par date
            const dateInput = document.getElementById('dateInput');
            if (dateInput) {
                dateInput.addEventListener('change', mettreAJourTotauxApresFiltre);
            }

            const buttons = document.querySelectorAll('.btn-outline-warning, .btn-outline-success, .btn-outline-primary, .btn-outline-secondary, .btn-outline-danger');
    
            buttons.forEach(button => {
                button.addEventListener('click', function() {
                    // Retirer active de tous les boutons
                    buttons.forEach(btn => btn.classList.remove('active'));
                    
                    // Ajouter active au bouton cliqu√©
                    this.classList.add('active');
                    
                    // Votre logique de filtrage ici
                    console.log('Bouton cliqu√©:', this.id);
                });
            });
        });
        
    </script>

</body>

</html>